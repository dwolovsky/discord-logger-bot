<!DOCTYPE html>
<html>
<head>
    <title>Firebase Auth Emulator Sign-In</title>
</head>
<body>
    <h1>Sign In to Get ID Token</h1>
    <p>Test User Email: testuser@example.com</p>
    <p>Test User Password: password123</p>
    <p>Open browser console (F12) to see ID Token and UID after successful sign-in.</p>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"; // Using a recent version
      import { getAuth, connectAuthEmulator, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

      // ================================================================================
      // !!! IMPORTANT: REPLACE WITH YOUR ACTUAL FIREBASE PROJECT CONFIGURATION !!!
      // You can find these in the Firebase console:
      // Project settings (gear icon) > Project settings > General tab > Your apps > Web app (if you have one)
      // If you don't have a web app registered, you can add one quickly to get this config.
      // The apiKey and projectId are the most critical for the emulator to link correctly.
      // ================================================================================
      const firebaseConfig = {
        apiKey: "AIzaSyCd579hkMc5SqfTbJXSigciVzYQOk3IS0I",    // <<< REPLACE
        authDomain: "self-science-bot.firebaseapp.com", // <<< REPLACE
        projectId: "self-science-bot",                 // <<< YOUR PROJECT ID (Looks correct)
        storageBucket: "self-science-bot.firebasestorage.app",  // <<< REPLACE (Optional, but good to have if used)
        messagingSenderId: "287861418202",           // <<< REPLACE (Optional)
        appId: "1:287861418202:web:2731a2a70692d326535de3"                       // <<< REPLACE (Optional)
      };
      // ================================================================================

      try {
        initializeApp(firebaseConfig);
        const auth = getAuth();

        // Connect to the local Auth Emulator
        // The host and port should match what your Auth emulator is running on (default is 9099)
        connectAuthEmulator(auth, "http://localhost:9099", { disableWarnings: true }); 
        console.log("Attempting to connect to Auth Emulator at http://localhost:9099...");

        // Use the test user you created in the Emulator UI
        const email = "testuser@example.com";
        const password = "password123";

        console.log(`Attempting to sign in as ${email}...`);
        signInWithEmailAndPassword(auth, email, password)
          .then(async (userCredential) => {
            console.log("Sign-in successful for:", userCredential.user.email);
            const idToken = await userCredential.user.getIdToken();
            const uid = userCredential.user.uid;

            console.log("----- Firebase ID Token (Copy this whole string) -----");
            console.log(idToken);
            console.log("----- User UID (Should match your test user) -----");
            console.log(uid); // This should be yiPxwxOPz2fZwz3tAe4S8EvkaMFY

            alert(`Signed in as ${userCredential.user.email}! Check browser console for ID Token and UID.`);
          })
          .catch((error) => {
            console.error("Sign-in error:", error.code, error.message);
            alert("Sign-in error: " + error.message + "\nCheck console for details. Ensure Auth Emulator is running and user exists.");
          });
      } catch (e) {
        console.error("Firebase initialization error:", e);
        alert("Firebase initialization error: " + e.message + "\nEnsure firebaseConfig is correct.");
      }
    </script>
</body>
</html>